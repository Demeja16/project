var card={},overlay=$(".overlay");function loadCard(){localStorage.getItem("card")&&(card=JSON.parse(localStorage.getItem("card")),showCard())}function showCard(){isEmpty(card)?($(".basket__items").prepend('<h2 class="basket__status">Корзина пуста</h2>'),$(".basket__item").remove()):$.getJSON("products.json",function(a){var t=a,e="";for(var s in card)e+='<div class="basket__item">',e+='<picture class="basket__item-photos">',e+='<source media="(min-width: 1250px)" srcset="'+t[s].imgWebp1250+'" type="image/webp">',e+='<source media="(min-width: 1250px)" srcset="'+t[s].img1250+'">',e+='<source media="(min-width: 768px)" srcset="'+t[s].imgWebp768+'" type="image/webp">',e+='<source media="(min-width: 768px)" srcset="'+t[s].img768+'">',e+='<source srcset="'+t[s].imgWebp+'" type="image/webp">',e+='<img src="'+t[s].img+'" class="product__photo">',e+="</picture>",e+='<div class="basket__item-desc-wrapper">',e+='<a href="#" class="basket__item-name">'+t[s].name+"</a>",e+='<p class="basket__item-arguments">'+t[s].arguments+"</p>",e+='<p class="basket__item-desc">'+t[s].desc+"</p>",e+='<p class="basket__item-quantity-name">Кол-во</p>',e+='<div class="basket__item-quantity-wrapper">',e+='<a class="basket__item-quantity-btn basket__item-quantity-minus" data-product-id="'+s+'"></a>',e+='<span class="input-quantity basket__item-quantity" data-cost="'+t[s].cost+'">'+card[s]+"</span>",e+='<a class="basket__item-quantity-btn basket__item-quantity-plus" data-product-id="'+s+'"></a>',e+="</div>",e+='<span class="basket__item-cost item-cost">'+card[s]*t[s].cost+" руб</span>",e+="</div>",e+='<a class="basket__item-remove-btn" data-product-id="'+s+'"></a>',e+="</div>";$(".basket__items").html(e),$(".basket__item-remove-btn").on("click",delProd),$(".basket__item-quantity-plus").on("click",plusProd),$(".basket__item-quantity-minus").on("click",minusProd)})}function delProd(a){var t=parseInt($(this).attr("data-product-id"));delete card[t],saveCard(),loadCard()}function plusProd(a){var t=$(this).attr("data-product-id");card[t]++,saveCard(),loadCard()}function minusProd(a){var t=$(this).attr("data-product-id");if(card[t]--,card[t]<=0)return!(card[t]=1);saveCard(),loadCard()}function saveCard(){localStorage.setItem("card",JSON.stringify(card))}function isEmpty(a){for(var t in a)if(a.hasOwnProperty(t))return!1;return!0}function sendBasket(a){a.preventDefault();var t=$("#customerTel").val(),e=$("#customerEmail").val(),s=$("#customerOptions").val();if(console.log(t,e,s),isEmpty(card))overlay.toggleClass("overlay--active"),$(".error-modal__title").html("Корзина пуста"),$(".error-modal").toggleClass("modal--active");else{if(""==t||""==e)return overlay.toggleClass("overlay--active"),$(".error-modal__title").html("Заполните поля"),void $(".error-modal").toggleClass("modal--active");s=""==s?"Нет пожеланий":s,$.post("core/card.php",{cTel:t,cEmail:e,cOp:s,card:card}).done(function(){overlay.toggleClass("overlay--active"),$(".success-modal").toggleClass("modal--active"),setTimeout(function(){$("form").trigger("reset")},1e3)}).fail(function(){overlay.toggleClass("overlay--active"),$(".error-modal").toggleClass("modal--active")})}}jQuery(document).ready(function(a){loadCard(),a(".basket__send-btn").on("click",sendBasket)});